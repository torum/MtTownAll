# MtTownAll

A GUI applicaton for converting **"mt_town_all.csv"** (全国 町字マスター) file from the Digital Agency of Japan's [base registry for address](https://www.digital.go.jp/en/policies/base_registry_address) into a SQLite database.  

デジタル庁が[公開](https://www.digital.go.jp/policies/base_registry_address)している「全国 町字データ」**"mt_town_all.csv"** を扱いやすいSQLiteデータベースファイルに変換するコンバーター、GUIアプリケーション。

## Current Status
**Work in Progress**  

![MtTownAll](https://github.com/torum/MtTownAll/blob/main/Images/Screenshot.png?raw=true) 

## The problem

現状、アプリケーション内で郵便番号から住所を引いたり、その逆をしようとすると日本郵便が提供している住所CSVデータ「KEN\_ALL.CSV」（なぜか大文字のファイル名と拡張子・・前世紀のDOS時代の代物か？みたいな）を使うことになると思うのですが、これがまた滅茶苦茶なデータで、もうKEN\_ALL.CSVという単語を聞くだけでひきつけを起こしそうになるほど酷いのが有名です。

> 日本郵便の「KEN\_ALL.CSV」といえば、その汎用性の低い仕様ゆえ、かねてよりエンジニアの間では悪評が噴出していており、使いやすい形式に変換するための民間サービスまで登場していた。総務省はデジタル庁とも協議のうえでこれらに改善を施す旨公表していたが、改善された新たなCSVデータが6月30日に公開されたことが明らかになった。具体的には、半角カナだった読み仮名が全角カナへと変更されたほか、38文字を超えると分割されていたレコードを1つに統合。さらに文字コードはShift-JISからUTF-8へと変更されるなど、大幅な改善が行われている。まだ別の課題は残っているものの、従来では考えられなかった大きな進歩だ。  
> 2023年7月6日
> 
> [不評だった「KEN\_ALL.CSV」大幅改善で話題に。代替となる住所CSVデータを日本郵便が公開、カナ全角化・レコード統合・UTF-8導入など【やじうまWatch】 - INTERNET Watch](https://internet.watch.impress.co.jp/docs/yajiuma/1514259.html)

これ、2023年の記事ですが、**記事中にもあるように、これでもまだまだ問題が残っていて使い物にならないので**、民間の方が独自に「郵便番号データ（加工済バージョン）」として、データを修正したもの「x-ken-all.csv」を公開してくれてたりします。

> ・町域名が「以下に掲載がない場合」の場合は、ブランク（空文字）に置換
> 
> ・町域名が「○○市（または町・村）の次に番地がくる場合」の場合は、ブランク（空文字）に置換
> 
> ・町域名が「○○市（または町・村）一円」の場合は、ブランク（空文字）に置換
> 
> ・町域名で、丸括弧で囲まれている部分を除去  
> ※町域名の文字数が多いために複数行に分割されてしまっている場合は、1行にマージしておいてから丸括弧を除去します。  
> ※括弧内の文字が「地名」や「ビルの階」など、住所として使えそうなものは町域名の末尾に追加します。  
> ※括弧内に地名が複数列挙されている場合は複数行に分割します。
> 
> [郵便番号データのダウンロード - zipcloud](https://zipcloud.ibsnet.co.jp/)

ありがたや。

**一体全体、総務省もデジタル庁も何を考えてるのか**って感じですが、ぶっちゃけ日本全体がそんなレベルなんで、イチイチ嘆いていてもしょうがありません（投げやり）。

そんな未開な状況の日本ですが、デジタル庁において「郵便番号と町字データの紐づけを行う」ということになり、やっとまともな状況になろうとしつつあります。

> 「令和７年度中にデジタル庁において、郵便番号と町字データの紐づけを行う」
> 
> 「[公的基礎情報データベース整備改善計画](https://www.digital.go.jp/assets/contents/node/basic_page/field_ref_resources/816ebeda-f081-4b18-b593-20fd12eb19a9/6e8cdb91/20250613_plan_for_development_and_improvement_of_public_basic_information_database_outline_03.pdf) (PDF注意)」　15P

町字データは、いわゆる「市区町村マスター」みたいなのにつかわれるデータです。これに郵便番号が付加されると。今でも町字データに郵便番号のカラムは存在しているけど、全然不完全な状態で使い物にならなかったんですよね。

このデジタル庁の「全国 町字データ」のCSV「mt\_town\_all.csv」を、扱いやすいSQLiteデータベース形式に変換するコンバーター、GUIアプリケーションを丸一日かけてチョロッとつくりました。ついでに、都道府県の「mt\_pref\_all.csv」と、前述の「x-ken-all.csv」もSQLite化できるようにしてあります。

CSVパースしてSQLiteデータベースにぶっこむだけなんで、しごく単純、簡単なアプリです（とはいっても処理はちゃんと非同期＆マルチスレッド化している）。独自に何か処理を挟みたかったら適当にソース弄ってください。

こういう住所関連のデータは適時更新されるので、一回だけじゃなく何度も変換しなければならないため、ユーザー環境で誰でもいつでも簡単にデータ更新を出来るようにしておきたかった為です。

デジタル庁って出来てからまるで役に立つことしてないですけれど、少なくとも「KEN\_ALL.CSV」が不要になる程度のデータをメンテして公開してくれるのであれば「デジタル庁も少しは仕事しているな」と言えるようになりますね。

ただし・・・、「[アドレス・ベース・レジストリ　ダウンロードサイト](https://dataset.address-br.digital.go.jp/)」 も滅茶苦茶で一体全体、誰の為に作ってるのかまったくもって不明。さらに、CSVのカラム順の仕様を確認しようとしたら、マイクロソフトの表計算用のエクセル形式のファイルをダウンロードさせられたりして、本気でアレじゃないかとも思いましたが。デジタル庁とかいう名前が恥ずかしいぐらいであります。
